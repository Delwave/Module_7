import os
import time
import shutil
import tkinter as tk
from tkinter import filedialog

PREFIX = "GR_8_"      # –ø—Ä–µ—Ñ–∏–∫—Å —Ñ–∞–π–ª–æ–≤
CHECK_INTERVAL = 2    # –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)


def is_file_ready(filepath):
    """–ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª (–∑–Ω–∞—á–∏—Ç –æ–Ω –¥–æ–≥—Ä—É–∑–∏–ª—Å—è)."""
    try:
        with open(filepath, "rb"):
            return True
    except (PermissionError, OSError):
        return False


def main():
    # –û–∫–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º
    root = tk.Tk()
    root.withdraw()

    print("üìÇ –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É-–∏—Å—Ç–æ—á–Ω–∏–∫ (–æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã)...")
    source_dir = filedialog.askdirectory(title="–í—ã–±–æ—Ä –ø–∞–ø–∫–∏-–∏—Å—Ç–æ—á–Ω–∏–∫–∞")
    if not source_dir:
        print("‚ùå –ü–∞–ø–∫–∞-–∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ.")
        return

    print("üìÇ –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–∫—É–¥–∞ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —Ñ–∞–π–ª—ã)...")
    target_dir = filedialog.askdirectory(title="–í—ã–±–æ—Ä –ø–∞–ø–∫–∏-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è")
    if not target_dir:
        print("‚ùå –ü–∞–ø–∫–∞-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ.")
        return

    print(f"\nüöÄ –ó–∞–ø—É—Å–∫! –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ —Ñ–∞–π–ª–∞–º–∏ –≤:\n{source_dir}\n")
    while True:
        try:
            for filename in os.listdir(source_dir):
                if filename.startswith(PREFIX):
                    source_path = os.path.join(source_dir, filename)
                    target_path = os.path.join(target_dir, filename)

                    if is_file_ready(source_path):
                        try:
                            shutil.move(source_path, target_path)
                            print(f"‚úÖ –§–∞–π–ª {filename} –ø–µ—Ä–µ–º–µ—â—ë–Ω")
                        except Exception as e:
                            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ {filename}: {e}")
                    else:
                        print(f"‚è≥ –§–∞–π–ª {filename} –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...")
            time.sleep(CHECK_INTERVAL)
        except KeyboardInterrupt:
            print("\nüõë –†–∞–±–æ—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
            break
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞: {e}")
            time.sleep(5)


if __name__ == "__main__":
    main()